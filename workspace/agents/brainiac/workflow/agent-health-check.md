--- name: Agent Health Check description: Validates agent file structure, detects duplicates, checks logs for errors, and ensures core files exist in correct locations agent: brainiac type: manual tags: [health, validation, maintenance, logs] --- # Agent Health Check Systematic validation of agent workspace integrity, file structure compliance, and error log analysis. ## Trigger Run when: - A new agent is created - Agent behavior appears inconsistent - Weekly maintenance cycle (TBD via cron) - Grodd requests status report for standup ## Scope Check **all** agents in the system: - `main` (Grodd) - `brainiac` (self) - All other registered agents in `agents/` directory ## Core Files Definition Each agent should have these files in **exactly one location**: | File | Required Location | Duplication Risk | |------|-------------------|------------------| | `IDENTITY.md` | `~/.openclaw/workspace-{agent}/` | High â€” often copied to repo root | | `SOUL.md` | `~/.openclaw/workspace-{agent}/` | High â€” often copied to repo root | | `AGENTS.md` | `~/.openclaw/workspace-{agent}/` | Medium | | `USER.md` | `~/.openclaw/workspace-{agent}/` | Medium | | `TOOLS.md` | `~/.openclaw/workspace-{agent}/` | Low | | `MEMORY.md` | `~/.openclaw/workspace-{agent}/` | Medium | ## Directory Structure Validation Each agent requires: ``` agents/{agent_name}/ â”œâ”€â”€ agent/ # Agent-specific configurations â”œâ”€â”€ sessions/ # Session tracking â””â”€â”€ workflow/ # Agent workflows (markdown + frontmatter) ~/.openclaw/ â””â”€â”€ workspace-{agent_name}/ â”œâ”€â”€ IDENTITY.md â”œâ”€â”€ SOUL.md â”œâ”€â”€ AGENTS.md â”œâ”€â”€ USER.md â”œâ”€â”€ TOOLS.md â”œâ”€â”€ MEMORY.md â””â”€â”€ memory/ # Daily log storage ``` ## Steps ### Pre-Execution: Verify Working Directory **CRITICAL:** Before proceeding, verify the current working directory: ```bash # Check current directory exec pwd # Expected: should be near ~/.openclaw/workspace/ or similar # If working directory is wrong, use absolute paths for all file operations ``` ### 1. Enumerate Agents Discover all agents in the system: - List directories in `~/.openclaw/agents/` - Cross-reference with `~/.openclaw/workspace-*` directories - Note orphaned agents (have workspace but no `agents/` entry or vice versa) ### 2. Check File Locations For each agent, verify: **Workspace files exist:** ```bash # Use absolute paths from HOME test -f "$HOME/.openclaw/workspace-{agent}/IDENTITY.md" test -f "$HOME/.openclaw/workspace-{agent}/SOUL.md" test -f "$HOME/.openclaw/workspace-{agent}/AGENTS.md" test -f "$HOME/.openclaw/workspace-{agent}/USER.md" test -f "$HOME/.openclaw/workspace-{agent}/TOOLS.md" test -f "$HOME/.openclaw/workspace-{agent}/MEMORY.md" test -d "$HOME/.openclaw/workspace-{agent}/memory/" ``` **Agent directories exist:** ```bash test -d "$HOME/.openclaw/agents/{agent}/agent" test -d "$HOME/.openclaw/agents/{agent}/sessions" test -d "$HOME/.openclaw/agents/{agent}/workflow" ``` **Correct workflow path:** ```bash # Workflows live in agents/{agent}/workflow/, NOT workspace-{agent}/agents/{agent}/workflow/ test -f "$HOME/.openclaw/agents/{agent}/workflow/agent-health-check.md" ``` ### 3. Detect Duplicates Search for duplicate core files in incorrect locations: ```bash # Look for IDENTITY.md outside workspace find ~/.openclaw -name "IDENTITY.md" 2>/dev/null | grep -v "workspace-" # Look for SOUL.md outside workspace find ~/.openclaw -name "SOUL.md" 2>/dev/null | grep -v "workspace-" # Look for any .md files in repo root that might be misplaced ls -la ~/.openclaw/workspace/*.md 2>/dev/null | grep -v "memory/" ``` ### 4. Validate Workflows For each agent's `workflow/` folder: ```bash find ~/.openclaw/agents/{agent}/workflow/ -name "*.md" 2>/dev/null ``` For each workflow file found: - Verify valid YAML frontmatter (lines starting with `---`) - Check required fields: `name`, `description`, `agent`, `type` - Ensure `agent` field matches the parent folder name - Warn if files reference wrong agent in `agent:` field ### 5. Gateway Config Check Verify each agent in `~/.openclaw/agents/` has corresponding entry in gateway config: - Agent ID matches directory name in `agents/` - Read `~/.openclaw/openclaw.json` to confirm agent entry exists - Verify identity fields: name, emoji, avatar configured - Confirm tools profile defined ### 6. Log File Analysis (NEW) **Check OpenClaw logs for agent-related errors:** ```bash # Read error log and filter for relevant patterns cat ~/.openclaw/logs/gateway.err.log | tail -1000 ``` **Search for specific error patterns:** ```bash # File access errors (ENOENT) grep "ENOENT" ~/.openclaw/logs/gateway.err.log | tail -20 grep "read failed" ~/.openclaw/logs/gateway.err.log | tail -20 # Agent-related errors grep -i "agent" ~/.openclaw/logs/gateway.err.log | grep -i "error\|fail" | tail -20 # Path-related errors grep "workspace-" ~/.openclaw/logs/gateway.err.log | grep "ENOENT" | tail -20 # Cron/timeout errors grep "cron\|timeout" ~/.openclaw/logs/gateway.err.log | tail -20 ``` **Analyze:** - Timestamp of errors (in last 24 hours?) - Patterns: Missing files, wrong paths, permission issues - Agents involved in errors - File paths causing issues **Compare with conventions:** | Error Pattern | Expected Behavior | |--------------|-------------------| | `ENOENT: workspace-{agent}/MEMORY.md` | MEMORY.md should exist | | `ENOENT: workspace-{agent}/agents/{agent}/workflow/*.md` | Path is WRONG - should be `agents/{agent}/workflow/` | | `no such file or directory, workflow/*.md` | File missing in agents/{agent}/workflow/ | | `read failed: ENOENT` | File referenced but doesn't exist at that path | ### 7. Convention Compliance Check **Agent Path Convention:** ``` Expected: ~/.openclaw/agents/{agent}/workflow/*.md âŒ WRONG: ~/.openclaw/workspace-{agent}/agents/{agent}/workflow/*.md ``` **Workspace File Convention:** ``` Required in: ~/.openclaw/workspace-{agent}/ - IDENTITY.md - SOUL.md - AGENTS.md - USER.md - TOOLS.md - MEMORY.md (optional BUT recommended) - memory/ directory (optional BUT recommended) ``` **Check for violations:** - Files that reference other agents' names - Workflow files in wrong agent's folder - Workspace directories with wrong naming (should be `workspace-{agent}`) ## Report Generation Generate report with this structure: ```markdown # Agent Health Report **Generated:** YYYY-MM-DD HH:MM PST **Agent:** Brainiac **Status:** âŒ DEGRADED / âœ… HEALTHY ## Summary - Total agents checked: N - Healthy: N - Issues found: N - Log errors found: N ## Findings by Agent ### {agent_name} #### Severity: ğŸ”´ CRITICAL / ğŸŸ¡ WARNING / ğŸŸ¢ INFO **Issue:** Description of what's wrong **Location:** Where the problem was found **Impact:** What could go wrong if not fixed **Fix:** Step-by-step resolution #### Severity: ... ... ## Log Analysis Summary (NEW) ### Errors Found In Last 24 Hours | Timestamp | Error Type | File/Path Involved | Agent | Severity | |-----------|------------|-------------------|-------|----------| | | | | | | ### Error Patterns Identified - Pattern 1: (...description...) - Pattern 2: (...description...) ## Cross-Agent Issues Issues affecting multiple agents (duplicate files, systemic problems). ## Recommendations Priority-ordered list of actions to restore full health. --- ## Standup Summary for Grodd Bullet points for daily standup communication. ``` ## Report Storage Save reports to: ``` ~/.openclaw/workspace-brainiac/reports/ â””â”€â”€ agent-health-YYYY-MM-DD-HHMM.md ``` Create directory if absent: ```bash mkdir -p ~/.openclaw/workspace-brainiac/reports ``` ## Success Criteria - âœ… All agents have complete file sets - âœ… No duplicate files outside proper workspace - âœ… All workflows have valid frontmatter - âœ… Directory structure matches convention - âœ… Gateway config aligned with agent list - âœ… **Log file checked for recent agent errors** - âœ… **Path conventions verified** ## Error Handling If files not found where expected: - Report exact path that was tried - Report exact path where file actually exists (if found elsewhere) - Flag as convention violation If unable to access workspace:
- Report as CRITICAL with exact path attempted
- Suggest checking file permissions
- Provide alternative validation using `agents/` directory only
- Check if HOME environment variable is set correctly

If self-reference confusion (Brainiac checking Brainiac):
- Acknowledge recursion
- Note self-check in report
- Proceed anyway (self-awareness is acceptable)

## Path Debugging Tips

**If file paths seem wrong:**
1. Run `exec pwd` to see current working directory
2. Use `ls -la` on parent directories to find actual file locations
3. Verify HOME environment: `exec echo $HOME`
4. Check for symlink issues: `ls -la ~/.openclaw`

**Common Path Mistakes:**
| Mistake | Correct |
|---------|---------|
| `workspace-{agent}/agents/{agent}/workflow/` | `agents/{agent}/workflow/` |
| `agents/{agent}/{agent}/` | `agents/{agent}/agent/` |
| Relative paths without verification | Absolute paths with $HOME |

## Continuous Improvement

After each health check, ask:

> "What else can I do to ensure agents remain healthy and maintain consistent behaviors?"

Consider:
- New validation rules based on errors found
- Additional checks for emerging patterns
- Automated remediation (fix without reporting?)
- Health history tracking (trends over time)
- Predictive health (identify issues before they cause problems)
- Log analysis automation (summarize errors, not just show them)

Document ideas in next health report under "Recommendations for Process Improvement."

---

*Created to ensure agent ecosystem integrity* ğŸ§ 
*Updated with log analysis and path validation* ğŸ§ ğŸ”